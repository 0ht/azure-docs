---
title: Tutorial - Dataflow from an asset to Azure Event Grid and Microsoft Fabric
description: Tutorial on how to set up a dataflow from an asset to Azure Event Grid and Microsoft Fabric.
author: PatAltimore
ms.author: patricka
ms.subservice: azure-mqtt-broker
ms.topic: tutorial
ms.date: 07/23/2024

#CustomerIntent: As an operator, I want to understand how to I can use Dataflows to .
---

# Dataflow from an asset to Azure Event Grid and Microsoft Fabric

In this tutorial, you will set up a dataflow from an asset to Azure Event Grid and Microsoft Fabric. You will configure the source to read data from an asset, the destination to send data to Azure Event Grid and Microsoft Fabric, and apply a transformation to the data.

1. Create the asset.
2. Create an IoT MQ endpoint.

   ```yaml
   apiVersion: connectivity.iotoperations.azure.com/v1beta1
   kind: DataflowEndpoint
   metadata:
     name: mq
   spec:
     endpointType: mqtt
     mqttSettings: {}
   ```

3. Create an Azure Event Grid endpoint.

   ```yaml
   apiVersion: connectivity.iotoperations.azure.com/v1beta1
   kind: DataflowEndpoint
   metadata:
     name: eventgrid
   spec:
     endpointType: mqtt
     authentication:
       method: systemAssignedManagedIdentity
       systemAssignedManagedIdentitySettings: {}
     mqttSettings:
       host: example.westeurope-1.ts.eventgrid.azure.net:8883
       tls:
         mode: enabled
   ```

4. Create a Microsoft Fabric endpoint.

   ```yaml
   apiVersion: connectivity.iotoperations.azure.com/v1beta1
   kind: DataflowEndpoint
   metadata:
     name: fabric
   spec:
     endpointType: fabricOneLake
     authentication:
       method: systemAssignedManagedIdentity
       systemAssignedManagedIdentitySettings: {}
     fabricOneLakeSettings:
       host: <example>.dfs.fabric.microsoft.com
       names:
         workspaceName: <example-workspace-name>
         lakehouseName: <example-lakehouse-name>
       oneLakePathType: tables          
   ```

5. Create the Parquet schema and store it in the schema registry

   ```json
   {
    "type": "record",
    "name": "Temperature",
    "fields": [
      {"name": "deviceId", "type": "string"},
      {"name": "temperatureCelsius", "type": "float"}
      {"name": "location", "type": "string"}
    ]
   }
   ```

6. Create two dataflows both with the asset as the source, Azure Event Grid as one destination, and Microsoft Fabric as the second destination.

    ```yaml
    apiVersion: connectivity.iotoperations.azure.com/v1beta1
    kind: Dataflow
    metadata:
      name: to-eventgrid
    spec:
      operations:
      - operationType: source
        name: source1
        sourceSettings:
          endpointRef: mq
          dataSources:
            - <auto-generated-asset-topic>
      - operationType: destination
        name: destination1
        destinationSettings:
          endpointRef: eventgrid
          dataDestination: factory/$topic.2
    ---
    apiVersion: connectivity.iotoperations.azure.com/v1beta1
    kind: Dataflow
    metadata:
      name: to-fabric
    spec:
      operations:
      - operationType: source
        name: source1
        sourceSettings:
          endpointRef: mq
          dataSources:
            - <auto-generated-asset-topic>
      - operationType: builtInTransformation
        builtInTransformationSettings:
          serializationFormat: parquet
          schemaRef: aio-sr://exampleNamespace/exmapleParquetSchema:1.0.0
      - operationType: destination
        name: destination1
        destinationSettings:
          endpointRef: fabric
          dataDestination: telemetryTable
    ```
