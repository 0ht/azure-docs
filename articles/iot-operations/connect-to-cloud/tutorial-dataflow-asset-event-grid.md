---
title: Tutorial - Create a dataflow from an asset to Azure Event Grid
description: Tutorial on how to set up a dataflow from an asset to Azure Event Grid.
author: PatAltimore
ms.author: patricka
ms.subservice: azure-mqtt-broker
ms.topic: tutorial
ms.date: 07/25/2024

#CustomerIntent: As an operator, I want to understand how to set up a dataflow from an asset to Azure Event Grid.
---

# Tutorial: Create a dataflow from an asset to Azure Event Grid

In this tutorial, you set up a dataflow from an asset to Azure Event Grid. You configure the source to read data from an asset, the destination to send data to Azure Event Grid, and apply a transformation to the data.

1. Create the asset.
1. Create an MQTT broker endpoint by creating a file named `mqtt-endpoint.yaml` with the following content:

   ```yaml
   apiVersion: connectivity.iotoperations.azure.com/v1beta1
   kind: DataflowEndpoint
   metadata:
     name: mq
   spec:
     endpointType: mqtt
     mqttSettings: {}
   ```

1. Apply the configuration to create the MQTT broker endpoint.

   ```bash
   kubectl apply -f mqtt-endpoint.yaml
   ```

1. Create an Azure Event Grid endpoint by creating a file named `eventgrid-endpoint.yaml` with the following content:

   ```yaml
   apiVersion: connectivity.iotoperations.azure.com/v1beta1
   kind: DataflowEndpoint
   metadata:
     name: eventgrid
   spec:
     endpointType: mqtt
     authentication:
       method: systemAssignedManagedIdentity
       systemAssignedManagedIdentitySettings: {}
     mqttSettings:
       host: example.westeurope-1.ts.eventgrid.azure.net:8883
       tls:
         mode: enabled
   ```

1. Apply the configuration to create the Azure Event Grid endpoint.

   ```bash
   kubectl apply -f eventgrid-endpoint.yaml
   ```

1. Create a dataflow with the asset as the source and Azure Event Grid as the destination by creating a file named `dataflow.yaml` with the following content:

    ```yaml
    apiVersion: connectivity.iotoperations.azure.com/v1beta1
    kind: Dataflow
    metadata:
      name: to-eventgrid
    spec:
      operations:
      - operationType: source
        name: source1
        sourceSettings:
          endpointRef: mq
          dataSources:
            - <auto-generated-asset-topic>
      - operationType: destination
        name: destination1
        destinationSettings:
          endpointRef: eventgrid
          dataDestination: factory/$topic.2
    ```

1. Send test data to the dataflow.
1. View messages in Azure Event Grid.
1. Send test data to Azure Event Grid.
1. View messages in MQTT broker.